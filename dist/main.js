(()=>{"use strict";const e=new class{async fetchGif(e){let t=document.querySelector(".card");await fetch(e,{mode:"cors"}).then((e=>{e.json().then((e=>{let s=Object.values(e.data.images);t.setAttribute("style",`background: #FFF url(${s[0].url}) no-repeat center center`)}))}))}},t=new class{constructor(){this.showSpinner=this.showSpinner.bind(this),this.listCities=this.listCities.bind(this),this.filterCities=this.filterCities.bind(this),this.showWeather=this.showWeather.bind(this),this.showMessage=this.showMessage.bind(this),this.setMessage=this.setMessage.bind(this),this.message=document.querySelector(".message")}setMessage(e){this.message.innerHTML=e}showMessage(e){e?this.message.setAttribute("class","message d-flex"):this.message.setAttribute("class","message d-none")}showSpinner(e){document.querySelector(".spinner-border").setAttribute("class","spinner-border "+(1==e?"d-flex":"d-none"))}filterCities(e){return new Promise(((t,s)=>{try{return t(this.cities.map((({id:t,name:s})=>s.toLowerCase().startsWith(e.toLowerCase())?{id:t,name:s}:"fail")).filter((e=>"fail"!==e)))}catch{return s("An error ocurred while working on cities")}}))}async showWeather(t){this.showSpinner(!0),this.setMessage("Reading weather for the chosen city");let s=await fetch(`https://api.openweathermap.org/data/2.5/weather?id=${t.target.id}&units=metric&appid=2adf01b5e325f219ebee645945fa0afa`,{method:"GET"}),{weather:i,main:r}=await s.json(),{temp:n}=r,a=document.querySelector(".card-title"),c=t.target.innerText,h=document.querySelector(".card-text"),o=document.querySelector(".temperature"),{description:d,main:l}=i[0];a.innerHTML=c,h.innerHTML=`${d}`,o.innerText=`Temperature: ${n} celsius`,await e.fetchGif(`https://api.giphy.com/v1/gifs/translate?api_key=xAnFWdRoLn8lovTUuq1pkhGAl6dXd253&s=${l}`),this.showSpinner(!1)}async listCities(e){let t=document.querySelector(".search-city").value;if(t){this.showSpinner(!0),this.showMessage(!0),this.setMessage("Reading cities file");const e=await fetch("city.list.min.json");this.setMessage("File read, transforming in json"),this.cities=await e.json();const s=document.querySelector(".cities");this.setMessage("Fetching cities"),this.showMessage(!1),this.cities=await this.filterCities(t),s.innerHTML="",await this.cities.forEach((function({id:e,name:t}){let i=document.createElement("li"),r=document.createElement("a");r.setAttribute("id",e),r.setAttribute("class","dropdown-item"),r.setAttribute("href","#"),r.innerText=t,i.appendChild(r),s.appendChild(i)})),document.querySelectorAll(".dropdown-item").forEach((e=>{e.addEventListener("click",this.showWeather,!1)})),document.querySelector(".select-cities").setAttribute("class","dropdown select-cities d-flex"),this.showSpinner(!1)}}};document.querySelector(".submit-city").addEventListener("click",t.listCities,!1)})();